<!-- templates/view_all_data.html -->

{% extends "base.html" %}

{% block title %}Ver Todos los Datos{% endblock %}

{% block customCSS %}
    <!-- Estilos específicos para la vista "Ver Todos los Datos" -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/Formularios.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block body %}
<div class="container mt-5">
    <h1 class="h3 mb-4 text-center"><i class="fas fa-database"></i> Ver Todos los Datos</h1>
    
    <!-- Botón para descargar la información en PDF -->
    <div class="d-flex justify-content-center mb-4">
        <button id="downloadPdfBtn" class="btn btn-primary">
            <i class="fas fa-file-pdf me-2"></i>Descargar toda la información en PDF
        </button>
    </div>

    <!-- Datos Personales -->
    <div id="datosPersonales" class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div><i class="fas fa-user"></i> Datos Personales</div>
            <button class="btn btn-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDatosPersonales" aria-expanded="true" aria-controls="collapseDatosPersonales">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div id="collapseDatosPersonales" class="collapse show">
            <div class="card-body">
                {% if datos_personales %}
                    {% for dato in datos_personales %}
                        <table class="table table-striped">
                            <tbody>
                                <tr>
                                    <th scope="row">Nombre Completo</th>
                                    <td>{{ dato[4] }} {{ dato[2] }} {{ dato[3] }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Código UNA</th>
                                    <td>{{ dato[13] }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">DNI</th>
                                    <td>{{ dato[9] }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Fecha de Nacimiento</th>
                                    <td>{{ dato[5] }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Lugar de Nacimiento</th>
                                    <td>{{ dato[6] }}, {{ dato[7] }}, {{ dato[8] }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Condición</th>
                                    <td>{{ dato[14] }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Categoría</th>
                                    <td>{{ dato[15] }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Dedicación</th>
                                    <td>{{ dato[16] }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Teléfono Fijo</th>
                                    <td>{{ dato[17] or 'No registrado' }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Teléfono Móvil</th>
                                    <td>{{ dato[18] or 'No registrado' }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Correo Personal</th>
                                    <td>{{ dato[19] or 'No registrado' }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Correo Institucional</th>
                                    <td>{{ dato[20] or 'No registrado' }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Domicilio Actual</th>
                                    <td>{{ dato[21] or 'No registrado' }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Foto Docente</th>
                                    <td>
                                        {% if dato[23] and dato[23] in imagenes_dict %}
                                            <a href="{{ url_for('uploaded_file', filename=imagenes_dict[dato[23]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                <i class="fas fa-file-alt"></i> Ver Archivo
                                            </a>
                                        {% else %}
                                            <span class="text-muted">No disponible</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row">Constancia de Habilitación</th>
                                    <td>
                                        {% if dato[24] and dato[24] in imagenes_dict %}
                                            <a href="{{ url_for('uploaded_file', filename=imagenes_dict[dato[24]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                <i class="fas fa-file-alt"></i> Ver Archivo
                                            </a>
                                        {% else %}
                                            <span class="text-muted">No disponible</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    {% endfor %}
                {% else %}
                    <p>No hay datos personales disponibles.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Grados y Títulos -->
    <div id="gradosTitulos" class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div><i class="fas fa-graduation-cap"></i> Grados y Títulos</div>
            <button class="btn btn-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGradosTitulos" aria-expanded="true" aria-controls="collapseGradosTitulos">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div id="collapseGradosTitulos" class="collapse show">
            <div class="card-body">
                {% if gradostitulos %}
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Título</th>
                                    <th>Tipo</th>
                                    <th>Universidad</th>
                                    <th>País</th>
                                    <th>Fecha Expedición</th>
                                    <th>Archivo</th>
                                    <th>Archivo Sunedu</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for grado in gradostitulos %}
                                    <tr>
                                        <td>{{ grado[2] }}</td>
                                        <td>{{ grado[3] }}</td>
                                        <td>{{ grado[5] }}</td>
                                        <td>{{ grado[6] }}</td>
                                        <td>{{ grado[7] }}</td>
                                        <td>
                                            {% if grado[8] and grado[8] in imagenes_dict %}
                                                <a href="{{ url_for('uploaded_file', filename=imagenes_dict[grado[8]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-file-alt"></i> Ver Archivo
                                                </a>
                                            {% else %}
                                                <span class="text-muted">No disponible</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if grado[9] and grado[9] in imagenes_dict %}
                                                <a href="{{ url_for('uploaded_file', filename=imagenes_dict[grado[9]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-file-alt"></i> Ver Archivo Sunedu
                                                </a>
                                            {% else %}
                                                <span class="text-muted">No disponible</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p>No hay grados y títulos disponibles.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Carga Académica Lectiva -->
    <div id="cargaAcademica" class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div><i class="fas fa-book"></i> Carga Académica Lectiva</div>
            <button class="btn btn-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCargaAcademica" aria-expanded="true" aria-controls="collapseCargaAcademica">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div id="collapseCargaAcademica" class="collapse show">
            <div class="card-body">
                {% if carga_academica %}
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Periodo Académico</th>
                                    <th>Número Memorándum</th>
                                    <th>Horas Asignadas</th>
                                    <th>Memorándum</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for carga in carga_academica %}
                                    <tr>
                                        <td>{{ carga[2] }}</td>
                                        <td>{{ carga[3] }}</td>
                                        <td>{{ carga[5] }}</td>
                                        <td>
                                            {% if carga[4] and carga[4] in imagenes_dict %}
                                                <a href="{{ url_for('uploaded_file', filename=imagenes_dict[carga[4]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-file-alt"></i> Ver Archivo
                                                </a>
                                            {% else %}
                                                <span class="text-muted">No disponible</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p>No hay datos de Carga Académica Lectiva disponibles.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Actualizaciones y Capacitaciones -->
    <div id="actualizacionesCapacitaciones" class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div><i class="fas fa-chalkboard-teacher"></i> Actualizaciones y Capacitaciones</div>
            <button class="btn btn-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#collapseActualizacionesCapacitaciones" aria-expanded="true" aria-controls="collapseActualizacionesCapacitaciones">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div id="collapseActualizacionesCapacitaciones" class="collapse show">
            <div class="card-body">
                {% if actualizaciones_capacitaciones %}
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Tipo</th>
                                    <th>Descripción</th>
                                    <th>Información</th>
                                    <th>Institución Otorga</th>
                                    <th>Archivo</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for actualizacion in actualizaciones_capacitaciones %}
                                    <tr>
                                        <td>{{ actualizacion[2] }}</td>
                                        <td>{{ actualizacion[3] }}</td>
                                        <td>
                                            <strong>Horas:</strong> {{ actualizacion[4] or 'N/A' }}<br>
                                            <strong>Créditos:</strong> {{ actualizacion[5] or 'N/A' }}<br>
                                            <strong>Semestres Concluidos:</strong> {{ actualizacion[6] or 'N/A' }}
                                        </td>
                                        <td>{{ actualizacion[9] or 'N/A' }}</td>
                                        <td>
                                            {% if actualizacion[8] and actualizacion[8] in imagenes_dict %}
                                                <a href="{{ url_for('uploaded_file', filename=imagenes_dict[actualizacion[8]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-file-alt"></i> Ver Archivo
                                                </a>
                                            {% else %}
                                                <span class="text-muted">No disponible</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p>No hay datos de Actualizaciones y Capacitaciones disponibles.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Acreditación y Licenciamiento -->
    <div id="acreditacionLicenciamiento" class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div><i class="fas fa-certificate"></i> Acreditación y Licenciamiento</div>
            <button class="btn btn-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAcreditacionLicenciamiento" aria-expanded="true" aria-controls="collapseAcreditacionLicenciamiento">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div id="collapseAcreditacionLicenciamiento" class="collapse show">
            <div class="card-body">
                {% if acreditacion_licenciamiento %}
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Número de Resolución</th>
                                    <th>Fecha de Resolución</th>
                                    <th>Fecha Inicio</th>
                                    <th>Fecha Fin</th>
                                    <th>Cargo en el Comité</th>
                                    <th>Resolución</th>
                                    <th>Evidencias</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for acreditacion in acreditacion_licenciamiento %}
                                    <tr>
                                        <td>{{ acreditacion[6] }}</td>
                                        <td>{{ acreditacion[7] }}</td>
                                        <td>{{ acreditacion[4] or 'N/A' }}</td>
                                        <td>{{ acreditacion[5] or 'N/A' }}</td>
                                        <td>{{ acreditacion[8] or 'N/A' }}</td>
                                        <td>
                                            {% if acreditacion[2] and acreditacion[2] in imagenes_dict %}
                                                <a href="{{ url_for('uploaded_file', filename=imagenes_dict[acreditacion[2]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-file-alt"></i> Ver Evidencia
                                                </a>
                                            {% else %}
                                                <span class="text-muted">No disponible</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if acreditacion[3] and acreditacion[3] in imagenes_dict %}
                                                <a href="{{ url_for('uploaded_file', filename=imagenes_dict[acreditacion[3]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-file-alt"></i> Ver Evidencia
                                                </a>
                                            {% else %}
                                                <span class="text-muted">No disponible</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p>No hay datos de Acreditación y Licenciamiento disponibles.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Participación Gestión Universitaria -->
    <div id="participacionGestionUniversitaria" class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div><i class="fas fa-users"></i> Participación Gestión Universitaria</div>
            <button class="btn btn-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#collapseParticipacionGestionUniversitaria" aria-expanded="true" aria-controls="collapseParticipacionGestionUniversitaria">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div id="collapseParticipacionGestionUniversitaria" class="collapse show">
            <div class="card-body">
                {% if participaciongestionuniversitaria %}
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Cargo</th>
                                    <th>Fecha Inicio</th>
                                    <th>Fecha Fin</th>
                                    <th>Curso Relevante</th>
                                    <th>Plan</th>
                                    <th>Informe</th>
                                    <th>Curso</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for participation in participaciongestionuniversitaria %}
                                    <tr>
                                        <td>{{ participation[2] }}</td>
                                        <td>{{ participation[3] }}</td>
                                        <td>{{ participation[4] }}</td>
                                        <td>{{ participation[5] }}</td>
                                        <td>
                                            {% if participation[6] and participation[6] in imagenes_dict %}
                                                <a href="{{ url_for('uploaded_file', filename=imagenes_dict[participation[6]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-file-alt"></i> Ver Plan
                                                </a>
                                            {% else %}
                                                <span class="text-muted">No disponible</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if participation[7] and participation[7] in imagenes_dict %}
                                                <a href="{{ url_for('uploaded_file', filename=imagenes_dict[participation[7]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-file-alt"></i> Ver Informe
                                                </a>
                                            {% else %}
                                                <span class="text-muted">No disponible</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if participation[8] and participation[8] in imagenes_dict %}
                                                <a href="{{ url_for('uploaded_file', filename=imagenes_dict[participation[8]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-file-alt"></i> Ver Curso
                                                </a>
                                            {% else %}
                                                <span class="text-muted">No disponible</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p>No hay registros de participación en gestión universitaria.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Actividades de Proyección Social -->
    <div id="actividadesProyeccionSocial" class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div><i class="fas fa-handshake"></i> Actividades de Proyección Social</div>
            <button class="btn btn-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#collapseActividadesProyeccionSocial" aria-expanded="true" aria-controls="collapseActividadesProyeccionSocial">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div id="collapseActividadesProyeccionSocial" class="collapse show">
            <div class="card-body">
                {% if actividades_proyeccion_social %}
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead class="table-dark">
                                <tr>

                                    <th>Fecha</th>
                                    <th>Emitido Por</th>
                                    <th>Archivo</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for actividad in actividades_proyeccion_social %}
                                    <tr>
                                        <td>{{ actividad[4] }}</td>
                                        <td>{{ actividad[2] or 'N/A' }}</td>
                                        <td>
                                            {% if actividad[3] and actividad[3] in imagenes_dict %}
                                                <a href="{{ url_for('uploaded_file', filename=imagenes_dict[actividad[3]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-file-alt"></i> Ver Archivo
                                                </a>
                                            {% else %}
                                                <span class="text-muted">No disponible</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p>No hay datos de Actividades de Proyección Social disponibles.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Producción Intelectual -->
    <div id="produccionIntelectual" class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div><i class="fas fa-book"></i> Producción Intelectual</div>
            <button class="btn btn-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#collapseProduccionIntelectual" aria-expanded="true" aria-controls="collapseProduccionIntelectual">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div id="collapseProduccionIntelectual" class="collapse show">
            <div class="card-body">
                {% if produccionintelectual %}
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Tipo</th>
                                    <th>Título</th>
                                    <th>ISBN</th>
                                    <th>Depósito Legal</th>
                                    <th>Fecha Publicación</th>
                                    <th>Autor</th>
                                    <th>Coautor</th>
                                    <th>Archivo</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for prod in produccionintelectual %}
                                    <tr>
                                        <td>{{ prod[2] }}</td>
                                        <td>{{ prod[3] }}</td>
                                        <td>{{ prod[4] }}</td>
                                        <td>{{ 'Sí' if prod[5] else 'No' }}</td>
                                        <td>{{ prod[6] }}</td>
                                        <td>{{ 'Sí' if prod[7] else 'No' }}</td>
                                        <td>{{ 'Sí' if prod[8] else 'No' }}</td>
                                        <td>
                                            {% if prod[10] and prod[10] in imagenes_dict %}
                                                <a href="{{ url_for('uploaded_file', filename=imagenes_dict[prod[10]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-file-alt"></i> Ver Archivo
                                                </a>
                                            {% else %}
                                                <span class="text-muted">No disponible</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p>No hay registros de producción intelectual.</p>
                {% endif %}
            </div>
        </div>
    </div>   

    <!-- Investigaciones -->
    <div id="investigaciones" class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div><i class="fas fa-flask"></i> Investigaciones</div>
            <button class="btn btn-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInvestigaciones" aria-expanded="true" aria-controls="collapseInvestigaciones">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div id="collapseInvestigaciones" class="collapse show">
            <div class="card-body">
                {% if investigaciones %}
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Tipo</th>
                                    <th>Título</th>
                                    <th>Revista</th>
                                    <th>Índice</th>
                                    <th>Fecha de Publicación</th>
                                    <th>Autor</th>
                                    <th>Investigacion adjunta</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for investigacion in investigaciones %}
                                    <tr>
                                        <td>{{ investigacion[2] }}</td>
                                        <td>{{ investigacion[3] }}</td>
                                        <td>{{ investigacion[7] }}</td>
                                        <td>{{ investigacion[8] }}</td>
                                        <td>{{ investigacion[9] or 'N/A' }}</td>
                                        <td> 
                                            {% if investigacion[10] == 1 %}
                                              Si
                                            {% else %}
                                              {{ investigacion[10] or 'N/A' }}
                                            {% endif %}
                                          </td>
                                        <td>
                                            {% if investigacion[13] and investigacion[13] in imagenes_dict %}
                                                <a href="{{ url_for('uploaded_file', filename=imagenes_dict[investigacion[13]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-file-alt"></i> Ver Archivo
                                                </a>
                                            {% else %}
                                                <span class="text-muted">No disponible</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p>No hay datos de Investigaciones disponibles.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Idiomas -->
    <div id="idiomas" class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div><i class="fas fa-language"></i> Idiomas</div>
            <button class="btn btn-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#collapseIdiomas" aria-expanded="true" aria-controls="collapseIdiomas">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div id="collapseIdiomas" class="collapse show">
            <div class="card-body">
                {% if idiomas %}
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Idioma</th>
                                    <th>Nivel</th>
                                    <th>Certificado</th>
                                    <th>Archivo</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for idioma in idiomas %}
                                    <tr>
                                        <td>{{ idioma[2] }}</td>
                                        <td>{{ idioma[3] }}</td>
                                        <td>{{ 'Sí' if idioma[4] == 1 else 'No' }}</td>
                                        <td>
                                            {% if idioma[6] and idioma[6] in imagenes_dict %}
                                                <a href="{{ url_for('uploaded_file', filename=imagenes_dict[idioma[6]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-file-alt"></i> Ver Archivo
                                                </a>
                                            {% else %}
                                                <span class="text-muted">No disponible</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p>No hay datos de Idiomas disponibles.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Apoyo al estudiante -->
    <div id="tutorias" class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div><i class="fas fa-chalkboard-teacher"></i> Tutorías</div>
            <button class="btn btn-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTutorias" aria-expanded="true" aria-controls="collapseTutorias">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div id="collapseTutorias" class="collapse show">
            <div class="card-body">
                {% if tutorias %}
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Semestre</th>
                                    <th>Archivo</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for tutoria in tutorias %}
                                    <tr>
                                        <td>{{ tutoria[2] }}</td>
                                        <td>
                                            {% if tutoria[6] and tutoria[6] in imagenes_dict %}
                                                <a href="{{ url_for('uploaded_file', filename=imagenes_dict[tutoria[6]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-file-alt"></i> Ver Archivo
                                                </a>
                                            {% else %}
                                                <span class="text-muted">No disponible</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p>No hay datos de Tutorías disponibles.</p>
                {% endif %}
            </div>
        </div>
    </div>



    <!-- Reconocimientos -->
    <div id="reconocimientos" class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div><i class="fas fa-award"></i> Reconocimientos</div>
            <button class="btn btn-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#collapseReconocimientos" aria-expanded="true" aria-controls="collapseReconocimientos">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div id="collapseReconocimientos" class="collapse show">
            <div class="card-body">
                {% if reconocimientos %}
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Tipo</th>
                                    <th>Tipo de Institución</th>
                                    <th>Institución</th>
                                    <th>Fecha</th>
                                    <th>Archivo</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for reconocimiento in reconocimientos %}
                                    <tr>
                                        <td>{{ reconocimiento[2] }}</td>
                                        <td>{{ reconocimiento[8] }}</td>
                                        <td>{{ reconocimiento[4] if reconocimiento[4] else 'N/A' }}</td>
                                        <td>{{ reconocimiento[5] if reconocimiento[5] else 'N/A' }}</td>
                                        <td>
                                            {% if reconocimiento[7] and reconocimiento[7] in imagenes_dict %}
                                                <a href="{{ url_for('uploaded_file', filename=imagenes_dict[reconocimiento[7]]) }}" target="_blank" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-file-alt"></i> Ver Archivo
                                                </a>
                                            {% else %}
                                                <span class="text-muted">No disponible</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p>No hay datos de Reconocimientos disponibles.</p>
                {% endif %}
            </div>
        </div>
    </div>
    <!-- Agregar más secciones siguiendo la misma estructura -->
    
</div>
{% endblock %}

{% block customJS %}
    <!-- Carga la librería html2pdf -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        document.getElementById('downloadPdfBtn').addEventListener('click', function() {
    // Selecciona el contenedor que se convertirá en PDF
    const container = document.querySelector('.container');

    // Muestra un mensaje de carga
    const loadingMessage = document.createElement('div');
    loadingMessage.className = 'alert alert-info text-center';
    loadingMessage.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generando PDF, por favor espere...';
    container.prepend(loadingMessage);

    // Asegura que los elementos colapsables estén expandidos
    document.querySelectorAll('.collapse').forEach(collapse => {
        collapse.classList.add('show');
    });

    // Obtiene el nombre del docente para el nombre del archivo
    let nombreDocente = "Expediente_Docente";
    try {
        const datosNombre = document.querySelector('#collapseDatosPersonales tbody tr:first-child td');
        if (datosNombre) {
            nombreDocente = "Expediente_" + datosNombre.textContent.trim().replace(/\s+/g, '_');
        }
    } catch (e) {
        console.error("Error al obtener el nombre del docente", e);
    }

    // Clona el contenedor para no modificar el DOM original
    const containerClone = container.cloneNode(true);
    
    // Elimina elementos no importantes
    containerClone.querySelectorAll('.btn-secondary').forEach(btn => btn.remove());
    // Elimina elementos que contengan "No disponible"
    Array.from(containerClone.querySelectorAll('.text-muted')).forEach(el => {
        if (el.textContent.includes("No disponible")) {
            if (el.parentElement && el.parentElement.parentElement) {
                el.parentElement.parentElement.remove();
            }
        }
    });
    
    // Agrega estilos para el PDF con apariencia profesional usando el color #0F827F
    const styleProfessional = document.createElement('style');
    styleProfessional.innerHTML = `
/* Variables para colores y estilos comunes */
:root {
    --main-color: #0F827F;
    --light-bg: #f2f2f2;
    --border-color: #ddd;
    --text-color: #333;
    --secondary-text: #777;
}

/* Configuración general de la página para PDF */
@page {
    margin: 15mm;
    size: A4;
    @bottom-center {
        content: element(footer);
    }
}

/* Estilos globales */
body {
    font-family: 'Times New Roman', serif;
    font-size: 11pt;
    line-height: 1.4;
    color: var(--text-color);
}

/* Encabezado del PDF */
.pdf-header {
    text-align: center;
    margin-bottom: 20px;
    border-bottom: 2px solid var(--main-color);
    padding-bottom: 10px;
}

.logo {
    max-width: 180px;
    margin-bottom: 5px;
}

/* Títulos */
h1 {
    color: var(--main-color);
    font-size: 18pt;
    margin: 5px 0;
}

h2 {
    color: var(--main-color);
    font-size: 14pt;
    margin: 15px 0 10px 0;
    border-bottom: 1px solid var(--main-color);
    padding-bottom: 5px;
}

/* Secciones y saltos de página */
.section {
    margin-bottom: 20px;
    page-break-inside: avoid;
}

/* Tablas */
table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 15px;
    font-size: 10pt;
}

th {
    background-color: var(--light-bg);
    color: var(--text-color);
    font-weight: bold;
    text-align: left;
    padding: 6px;
    border: 1px solid var(--border-color);
}

td {
    padding: 5px;
    border: 1px solid var(--border-color);
}

tr:nth-child(even) {
    background-color: #f9f9f9;
}

/* Pie de página */
.footer {
    position: running(footer);
    text-align: center;
    font-size: 9pt;
    color: var(--secondary-text);
    border-top: 1px solid var(--border-color);
    padding-top: 5px;
}

.page-number:after {
    content: counter(page);
}

/* Tarjetas */
.card {
    margin-bottom: 15px;
    border: none;
    box-shadow: none;
}

.card-header {
    background-color: var(--main-color);
    color: white;
    padding: 8px 15px;
    font-weight: bold;
}

.card-body {
    padding: 10px 0;
}

/* Alertas ocultas */
.alert {
    display: none;
}

    `;
    containerClone.prepend(styleProfessional);

    // Crear encabezado profesional con el logo y título institucional
    const pdfHeader = document.createElement('div');
    pdfHeader.className = 'pdf-header';
    pdfHeader.innerHTML = `
        <img src="/static/img/logo_ccs_una.png" class="logo" alt="Logo Escuela Profesional de Ciencias de la Comunicación Social">
        <p>Escuela Profesional de Ciencias de la Comunicación Social</p>
        <p>Fecha de emisión: ${new Date().toLocaleDateString()}</p>
    `;
    containerClone.prepend(pdfHeader);
    
    // Crear pie de página
    const pdfFooter = document.createElement('div');
    pdfFooter.className = 'footer';
    pdfFooter.innerHTML = `
        <p>Documento generado el ${new Date().toLocaleDateString()} | Página <span class="page-number"></span></p>
        <p>Este documento es de carácter confidencial y para uso institucional</p>
    `;
    containerClone.appendChild(pdfFooter);
    
    // Reorganizar y limpiar contenido
    // Remueve botones "Ver Archivo" y reemplázalos con texto indicativo
    containerClone.querySelectorAll('.btn-primary').forEach(btn => {
        const newSpan = document.createElement('span');
        newSpan.textContent = '✓ Documento disponible';
        newSpan.style.color = '#28a745';
        btn.parentNode.replaceChild(newSpan, btn);
    });

    // Opciones para la generación del PDF
    const pdfOptions = {
        margin: [10, 10, 20, 10], // [top, right, bottom, left] en mm
        filename: nombreDocente + '.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { 
            scale: 2,
            useCORS: true,
            logging: false,
            letterRendering: true
        },
        jsPDF: { 
            unit: 'mm', 
            format: 'a4', 
            orientation: 'portrait',
            compress: true
        },
        pagebreak: { mode: 'avoid-all', before: '.page-break' }
    };

    // Genera y descarga el PDF
    html2pdf()
        .from(containerClone)
        .set(pdfOptions)
        .save()
        .then(() => {
            loadingMessage.remove();
            const successMessage = document.createElement('div');
            successMessage.className = 'alert alert-success text-center';
            successMessage.innerHTML = '<i class="fas fa-check-circle me-2"></i>PDF generado correctamente';
            container.prepend(successMessage);
            setTimeout(() => successMessage.remove(), 3000);
        })
        .catch(error => {
            console.error("Error generando PDF", error);
            loadingMessage.className = 'alert alert-danger text-center';
            loadingMessage.innerHTML = '<i class="fas fa-exclamation-circle me-2"></i>Error al generar el PDF. Intente nuevamente.';
            setTimeout(() => loadingMessage.remove(), 5000);
        });
});

    </script>
{% endblock %}


